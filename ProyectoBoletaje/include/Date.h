#ifndef Date_h
#define Date_h

#include <sstream>

using namespace std;

#define YEAR 2017

class Date{

private:
    bool validDate(int, int, int);
    bool validHora(int, int);
    int dia;
    int mes;
    int year;
    int hora;
    int minuto;
    bool esBisiesto();

public:
    // Constructores
    Date() = default;
    Date(int, int, int);
    Date(int, int, int, int, int);
    // Metodos
    void printFecha();
    void printHora();
    string getFechaStr();
    // Operadores
    Date operator+(int dias);
    bool operator>=(Date f);
    bool operator<=(Date f);
    bool operator==(Date f);
    // Getter
    int getYear()   {return year;}
    int getMes()    {return mes;}
};

Date::Date(int dia, int mes , int year){
    this->dia = dia;
    this->mes = mes;
    this->year = year;
}

Date::Date(int dia, int mes, int year, int hora, int minuto){
    this->dia = dia;
    this->mes = mes;
    this->year = year;
    this->hora = hora;
    this->minuto = minuto;
}

bool Date::validDate(int dia, int mes, int year){
    if (year < YEAR && year > YEAR + 2)
        return false;
    if ((mes == 1 || mes == 3 || mes == 5 || mes == 7 || mes == 8 || mes == 10 || mes == 12) && (dia < 1 || dia > 31))
        return false;
    if ((mes == 4 || mes == 6 || mes == 9 || mes == 11) && (dia < 1 || dia > 30))
        return false;
    if (mes == 2){
        if (((year % 4 == 0 && year % 100 != 0) || (year % 4 == 0 &&  year % 400 == 0)) && (dia < 1 || dia > 29))
            return false;
        else if (dia < 1 || dia > 28)
            return false;
    }

    return true;
}

bool Date::validHora(int hora, int minuto){
    if (hora < 0 || hora > 23) return false;
    if (minuto < 0 || minuto > 59) return false;
    return true;
}

bool Date::esBisiesto(){
    return (( year % 4 == 0 ) && ((year % 100 != 0)||(year % 400 == 0)));
}

void Date::printFecha(){
    cout << dia << "/" << mes << "/" << year << endl;
}

void Date::printHora(){
    cout<<setw(2)<<setfill('0')<<hora<<":"<<setw(2)<<setfill('0')<<minuto<<endl;
}

string Date::getFechaStr(){
    stringstream str;
    str << dia << "/" << mes << "/" << year << " - " << hora << ":" << minuto;
    return str.str();
}

Date Date::operator+(int dias){
    //Suma una cantidad de dias a una fecha, tomando en cuenta que puede sobrepasar meses y anios, ademas de verificar si el anio es bisiesto para contar el dia extra.
    //Se usa un switch para determinar la cantidad de dias de cada mes. Al pasar de un mes a otro, la variable de dia se hace 0 para sumar los dias restantes al siguiente mes. El metodo se acaba hasta que la cantidad de dias restantes a sumar sea 0.

    Date f = Date(dia,mes,year);

    do{

        bool b = esBisiesto();

        switch (f.mes){

            case 1:
            case 3:
            case 5:
            case 7:
            case 8:
            case 10:

                if (f.dia+dias > 31){
                    dias -= (31-f.dia);
                    f.mes++;
                    f.dia = 0;
                }
                else{
                    f.dia += dias;
                    dias = 0;
                }
                break;

            case 2:

                if(b){

                    if (f.dia+dias > 29){
                        dias -= (29-f.dia);
                        f.mes++;
                        f.dia = 0;
                    }
                    else{
                        f.dia += dias;
                        dias = 0;
                    }
                }

                else{
                    if (f.dia+dias > 28){
                        dias -= (28-f.dia);
                        f.mes++;
                        f.dia = 0;
                    }
                    else{
                        f.dia += dias;
                        dias = 0;
                    }
                }
                break;

            case 4:
            case 6:
            case 9:
            case 11:

                if (f.dia+dias > 30){
                    dias -= (30-f.dia);
                    f.mes++;
                    f.dia = 0;
                }
                else{
                    f.dia += dias;
                    dias = 0;
                }
                break;

            case 12:

                if (f.dia+dias > 31){
                    dias -= (31-f.dia);
                    f.mes = 1;
                    f.dia = 0;
                    f.year++;
                }
                else{
                    f.dia += dias;
                    dias = 0;
                }
                break;

            default:
                return f;
                break;
        }
    }while(dias>0);

    return f;
}

bool Date::operator>=(Date f){
    if (year > f.year) return true;
    if ((year == f.year) && (mes > f.mes)) return true;
    if (((year == f.year) && (mes == f.mes) && (dia > f.dia))) return true;
    if (((year == f.year) && (mes == f.mes) && (dia == f.dia))) return true;
    else return false;
}

bool Date::operator<=(Date f){
    if (year < f.year) return true;
    if ((year == f.year) && (mes < f.mes)) return true;
    if (((year == f.year) && (mes == f.mes) && (dia < f.dia))) return true;
    if (((year == f.year) && (mes == f.mes) && (dia == f.dia))) return true;
    else return false;
}

bool Date::operator==(Date f){
    return (((year == f.year) && (mes == f.mes) && (dia == f.dia)));
}

#endif /* Date_h */
